<mxfile host="app.diagrams.net" modified="2025-09-08T00:00:00.000Z" agent="drawio-desktop" version="22.1.0" type="device">
  <diagram id="cicd" name="CI-CD Cross-Account">
    <mxGraphModel dx="1280" dy="720" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1080" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Left: Tools / CI side -->
  <mxCell id="toolsBox" value="Tools Account" style="swimlane;fontStyle=1;rounded=0;horizontal=0;html=1;childLayout=stackLayout;horizontalStack=0;resizeParent=1;collapsible=0;" vertex="1" parent="1">
          <mxGeometry x="40" y="60" width="520" height="460" as="geometry"/>
        </mxCell>

        <mxCell id="git" value="GitHub Repo" style="shape=mxgraph.aws4.developer_tools;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="toolsBox">
          <mxGeometry x="40" y="60" width="80" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="gha" value="GitHub Actions\nCICD Workflow (OIDC)" style="shape=mxgraph.aws4.codepipeline;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="toolsBox">
          <mxGeometry x="160" y="50" width="120" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="sts" value="AWS STS" style="shape=mxgraph.aws4.security_token_service;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="toolsBox">
          <mxGeometry x="320" y="50" width="100" height="100" as="geometry"/>
        </mxCell>
        <mxCell id="iamUser" value="(Optional) IAM User\n(for local ops)" style="shape=mxgraph.aws4.iam;verticalLabelPosition=bottom;verticalAlign=top;opacity=60;html=1;" vertex="1" parent="toolsBox">
          <mxGeometry x="440" y="60" width="80" height="80" as="geometry"/>
        </mxCell>

        <!-- Right: Target Account -->
  <mxCell id="targetBox" value="Target Account" style="swimlane;fontStyle=1;rounded=0;horizontal=0;html=1;childLayout=stackLayout;horizontalStack=0;resizeParent=1;collapsible=0;" vertex="1" parent="1">
          <mxGeometry x="600" y="60" width="1280" height="680" as="geometry"/>
        </mxCell>

        <mxCell id="role" value="Cross-Account IAM Role" style="shape=mxgraph.aws4.iam_role;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="targetBox">
          <mxGeometry x="40" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="ecr" value="Amazon ECR" style="shape=mxgraph.aws4.ecr;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="targetBox">
          <mxGeometry x="160" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="ecs" value="Amazon ECS (Fargate)" style="shape=mxgraph.aws4.ecs;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="targetBox">
          <mxGeometry x="280" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="alb" value="Application Load Balancer" style="shape=mxgraph.aws4.application_load_balancer;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="targetBox">
          <mxGeometry x="400" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="s3web" value="S3 Website Bucket" style="shape=mxgraph.aws4.s3_bucket;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="targetBox">
          <mxGeometry x="520" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="cf" value="Amazon CloudFront" style="shape=mxgraph.aws4.cloudfront;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="targetBox">
          <mxGeometry x="640" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="docdb" value="Amazon DocumentDB" style="shape=mxgraph.aws4.documentdb;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="targetBox">
          <mxGeometry x="760" y="40" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- Steps labels -->
        <mxCell id="step1" value="1. Git Push" style="text;html=1;align=left;verticalAlign=middle;spacing=4;" vertex="1" parent="toolsBox">
          <mxGeometry x="40" y="160" width="120" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="step2" value="2. Assume Role (OIDC via STS)" style="text;html=1;align=left;verticalAlign=middle;spacing=4;" vertex="1" parent="toolsBox">
          <mxGeometry x="40" y="190" width="260" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="step3" value="3. Upload artifacts: Docker -> ECR, Frontend -> S3" style="text;html=1;align=left;verticalAlign=middle;spacing=4;" vertex="1" parent="targetBox">
          <mxGeometry x="40" y="150" width="480" height="30" as="geometry"/>
        </mxCell>
        <mxCell id="step4" value="4. Deploy: Update ECS Service, Invalidate CloudFront" style="text;html=1;align=left;verticalAlign=middle;spacing=4;" vertex="1" parent="targetBox">
          <mxGeometry x="40" y="180" width="460" height="30" as="geometry"/>
        </mxCell>

        <!-- Edges between CI and Target -->
        <mxCell id="edge_push" edge="1" parent="1" source="git" target="gha" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge_gha_sts" edge="1" parent="1" source="gha" target="sts" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge_sts_role" edge="1" parent="1" source="sts" target="role" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Edges for artifacts -->
        <mxCell id="edge_gha_ecr" edge="1" parent="1" source="gha" target="ecr" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"><mxPoint x="860" y="220" as="targetPoint"/></mxGeometry>
        </mxCell>
        <mxCell id="edge_gha_s3" edge="1" parent="1" source="gha" target="s3web" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Edges for deployment -->
        <mxCell id="edge_ecr_ecs" edge="1" parent="1" source="ecr" target="ecs" style="endArrow=block;html=1;strokeWidth=2;dashed=1;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge_ecs_alb" edge="1" parent="1" source="ecs" target="alb" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge_s3_cf" edge="1" parent="1" source="s3web" target="cf" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge_ecs_docdb" edge="1" parent="1" source="ecs" target="docdb" style="endArrow=block;html=1;strokeWidth=2;">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Notes -->
        <mxCell id="note1" value="ALB health: /actuator/health/liveness" style="shape=note;whiteSpace=wrap;html=1;size=12;fillColor=#fff2a8;strokeColor=#d6b656;" vertex="1" parent="targetBox">
          <mxGeometry x="40" y="230" width="220" height="40" as="geometry"/>
        </mxCell>
        <mxCell id="note2" value="OIDC trust: GitHub â†’ IAM Role (no long-lived keys)" style="shape=note;whiteSpace=wrap;html=1;size=12;fillColor=#fff2a8;strokeColor=#d6b656;" vertex="1" parent="toolsBox">
          <mxGeometry x="40" y="230" width="280" height="40" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
